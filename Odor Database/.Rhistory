out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(density = get_MW_from_cid(CID)) %>>% ungroup()
View(cid_smiles_MW)
?grep
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(density = get_MW_from_cid(CID)) %>>% ungroup() %>>% grep(",", "")
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(MW = get_MW_from_cid(CID) %>>% grep(",","")) %>>% ungroup()
get_MW_from_cid = function(cid) {
if (is.na(cid)) {
out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) #%>>%
#         (.[str_detect(., "\\d+")]) %>>%
#         paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(MW = get_MW_from_cid(CID)) %>>% ungroup()
get_MW_from_cid = function(cid) {
if (is.na(cid)) {
out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) #%>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(MW = get_MW_from_cid(CID)) %>>% ungroup()
cid <- 1254
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density,\n                    StringValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) #%>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
ensity = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ')
density
get_MW_from_cid = function(cid) {
if (is.na(cid)) {
out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) #%>>%
#         (.[str_detect(., "\\d+")]) %>>%
#         paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(MW = get_MW_from_cid(CID)) %>>% ungroup()
cid <- 1254
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
density = str_replace_all(source_PubChem, '\\"', '') %>>%
get_MW_from_cid = function(cid) {
if (is.na(cid)) {
out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
get_MW_from_cid = function(cid) {
if (is.na(cid)) {
out = "" #I changed this from NA without quotation marks
}
else {
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got) %>>% html_text()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Molecular Weight,\n                    NumValue: ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
cid_smiles_MW = cid_smiles_density %>>% rowwise() %>>% mutate(MW = get_MW_from_cid(CID)) %>>% ungroup()
View(cid_smiles_MW)
cid_smiles_MW_backup <- cid_smiles_MW
rm(source_PubChem)
cid_smiles_MW = cid_smiles_MW %>>% rowwise() %>>% mutate(MW = gsub(",", "", cid_smiles$MW))
for(i in 1: length(cid_smiles_MW$MW)){
cid_smiles_MW[i] <- gsub(",", "", cid_smiles_MW$MW)
}
View(cid_smiles_MW)
cid_smiles_MW <- cid_smiles_MW_backup
cid_smiles_MW$MW <- gsub(",", "", cid_smiles_MW$MW)
View(cid_smiles_MW)
write.csv(cid_smiles_MW, "compoundswithMWandDensity.csv")
?write.csv
View(cid_smiles)
smiles <- read.csv("AKOS.can", header = FALSE, sep = "")
names(smiles) <- c("smiles", "AKOS")
setwd("/Volumes/mainland/Projects/TAARs/Symrise\ -\ New\ Odors/Odor\ Database")
smiles <- read.csv("AKOS.can", header = FALSE, sep = "")
names(smiles) <- c("smiles", "AKOS")
View(smiles)
odors_dataframe <- merge(cid_smiles_MW, smiles, by.x = "input", by.y = "smiles")
View(odors_dataframe)
write.csv(odors_dataframe, "odorDatabasefromAKOS.csv") #saves this midpoint
df <- read.csv("odorDatabasefromAKOS.csv", header = TRUE)
View(df)
df <- read.csv("odorDatabasefromAKOS_modified.csv", header = TRUE)
View(df)
?read.csv
df <- read.csv("odorDatabasefromAKOS_modified.csv", header = TRUE, na.strings = "")
View(df)
df$AKOS <- gsub("AKOS", "", df$AKOS)
?sort
?order
df.2 <- sort.list(df$AKOS)
df.2 <- order(df$AKOS)
df.2 <- df[order(df$AKOS),]
View(df.2)
write.csv(df.2, "odorDatabase_sorted.csv")
?write.csv
write.csv(df.2, "odorDatabase_sorted.csv", na = "")
write.csv(df.2, "odorDatabase_sorted.csv", na = "")
?get_CID
library("dplyr")
library("tidyr")
library("stringr")
library("pipeR")
library("readr")
library("rvest")
library("httr")
library("purrr")
library("webchem")
?get_CID
?"webchem"
?purrrr
?purrr
?purrrr
?grep
View(df)
CID = 11022861
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
cid = CID
url = sprintf("https://pubchem.ncbi.nlm.nih.gov/rest/pug_view/data/compound/%s/JSON/", cid)
url = "www.chemspider.com/Chemical-Structure.2157.html"
out = tryCatch({
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got)
)
url_got = GET(url, user_agent("myagent"))
source_PubChem = read_html(url_got)
source_PubChem
source_PubChem[1]
source_PubChem[2]
source_PubChem[[1]]
?GET
url_got = GET(url, user_agent('6c2e700b-6a92-4551-9cc1-70f28c021f23'))
source_PubChem = read_html(url_got)
source_PubChem
source_chemSpi <- readHTMLTable(url_got)
?scan
source_chemSpi <- scan(url_got)
source_chemSpi <- scan(url)
?pc_prop
url_got = GET(url, user_agent('6c2e700b-6a92-4551-9cc1-70f28c021f23'))
source_PubChem = read_html(url_got) %>>% html_text()
source_PubChem
?str_split
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                     ') %>>% unlist()
density
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
paste(collapse = " | ")
str_split('Name: Density:\r\n                    \r\n                     ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
str_split('Name: Density:\r\n                    \r\n                     ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2)
)
density = str_replace_all(source_PubChem, '\\"', '')
source_PubChem
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                     ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2)
%>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                   ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                   ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2))
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                   ') %>>% unlist()
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\r\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                    ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\r\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                     ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\r\n", n = 2) %>>% (.[[1]][1]))
density
?map_chr
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:\r\n                    \r\n                      ') %>>% unlist() %>>%
map(~ str_split(.x, "\r\n", n = 2))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Name: Density:') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\r\n", n = 2)%>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                    \r\n                      ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\r\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                    \r\n                      ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1]))
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>% unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")])
density
?grep
str_detect?
)
?str_detect
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+.\\d+")])
density
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., paste("\\d+"."\\d+"))])
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")])
density
?gsub
density2 <- gsub("([0-9]+.*$", density)
density2 <- sub("([0-9]+.*$", density)
density2 <- as.numeric(gsub("[^\\d]+", "", density))
?str_split
density2 <- str_split(density, "\\d+", n = 2)
density2
as.numeric(gsub("[^0-9.]","",density))
density2 <- str_split(density, "[^0-9.]",n = 2)
density2
density2 <- str_split(density, "[^0-9.]",n = 2) %>>% (.[[1]][1])
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
str_split(.x, "[^0-9.]",n = 2) %>>% (.[[1]][1])
density = str_replace_all(source_PubChem, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
str_split( "[^0-9.]",n = 2) %>>% (.[[1]][1])
?sprintf
csid  <- 2157
rm(density)
url = sprintf("www.chemspider.com/Chemical-Structure.%s.html", cid)
url = sprintf("www.chemspider.com/Chemical-Structure.%s.html", csid)
url_got = GET(url, user_agent('6c2e700b-6a92-4551-9cc1-70f28c021f23'))
source_ChemSpi = read_html(url_got) %>>% html_text()
density = str_replace_all(source_ChemSpi, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
str_split("[^0-9.]",n = 2) %>>% (.[[1]][1])
df <- read.csv("/Volumes/mainland/Projects/TAARs/Symrise\ -\ New\ Odors/Symrise\ Odor\ Database/SymriseOdorList_forChemSpiPy.csv")
?grep
df$CAS_1 <- grept(";",df$CAS)
df$CAS_1 <- grep(";",df$CAS)
View(df)
?csplit
install.packages("splitstackshape")
library("splitstackshape")
?csplit
CAS<-cSplit(df, "CAS.no.",";")
View(CAS)
df <- read.csv("/Volumes/mainland/Projects/TAARs/Symrise\ -\ New\ Odors/Symrise\ Odor\ Database/SymriseOdorList_forChemSpiPy.csv") %>>%
cSplit("CAS.no.",";")
View(df)
df.noCAS <- df(which[is.na(df$CAS.no._1),])
df.noCAS <- df(which[df$CAS.no._1 == "NA",])
df.noCAS <- df[which(df$CAS.no._1 == "NA"),]
df.noCAS <- df[which(is.na(df$CAS.no._1),]
df.noCAS <- df[which(is.na(df$CAS.no._1)),]
View(df.noCAS)
df.CAS <- df[which(!is.na(df$CAS.no._1)),]
write.csv(df.noCAS, "/Users/mkamarck/Documents/chemspipy/Symrise.noCAS.csv")
write.csv(df.CAS, "/Users/mkamarck/Documents/chemspipy/Symrise.CAS.csv")
View(df)
df <- read.csv("/Volumes/mainland/Projects/TAARs/Symrise\ -\ New\ Odors/Symrise\ Odor\ Database/ChemID_MW_SMILES_everything.csv")
df.test <- df[1:10,:]
df.test <- df[1:10,]
View(df)
View(df.2)
View(df.test)
get_density_from_csid = function(csid) {
if (csid == 0) {
out = "NA" #I changed this from NA without quotation marks
}
else {
url = sprintf("www.chemspider.com/Chemical-Structure.%s.html", csid)
out = tryCatch({
url_got = GET(url, user_agent('6c2e700b-6a92-4551-9cc1-70f28c021f23'))
source_ChemSpi = read_html(url_got) %>>% html_text()
density = str_replace_all(source_ChemSpi, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
str_split("[^0-9.]",n = 2) %>>% (.[[1]][1]) #added in this line to just get the number of the density and not the units
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = NA
return(density)
},
silent = TRUE
)
}
return(out)
}
library("dplyr")
library("tidyr")
library("stringr")
library("pipeR")
library("readr")
library("rvest")
library("httr")
library("purrr")
library("webchem")
csid_density = df.test %>>% rowwise() %>>% mutate(density = get_density_from_csid(csid)) %>>% ungroup()
View(csid_density)
csid_density = df %>>% rowwise() %>>% mutate(density = get_density_from_csid(csid)) %>>% ungroup()
View(csid_density)
get_density_from_csid = function(csid) {
if (csid == 0) {
out = "NA" #I changed this from NA without quotation marks
}
else {
url = sprintf("www.chemspider.com/Chemical-Structure.%s.html", csid)
out = tryCatch({
url_got = GET(url, user_agent('6c2e700b-6a92-4551-9cc1-70f28c021f23'))
source_ChemSpi = read_html(url_got) %>>% html_text()
density = str_replace_all(source_ChemSpi, '\\"', '') %>>%
str_split('Density:\r\n                                            \r\n                                                ') %>>%
unlist() %>>%
map_chr(~ str_split(.x, "\n", n = 2) %>>% (.[[1]][1])) %>>%
(.[str_detect(., "\\d+")]) %>>%
str_split("[^0-9.]",n = 2) %>>% (.[[1]][1]) #added in this line to just get the number of the density and not the units
return(density)
},
error = function(e) {
cat("Error:", conditionMessage(e), "\n")
density = "NA"
return(density)
},
silent = TRUE
)
}
return(out)
}
rm(csid_density)
csid_density = df %>>% rowwise() %>>% mutate(density = get_density_from_csid(csid)) %>>% ungroup()
View(csid_density)
write_csv(csid_density, "SymriseOdors_Final.csv")
?write.csv
csid_density$CAS <- toString(csid$CAS)
?toString
csid_density$CAS <- toString(csid_density$CAS)
View(csid_density)
